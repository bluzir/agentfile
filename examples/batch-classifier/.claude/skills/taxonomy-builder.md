---
name: taxonomy-builder
type: composite
version: v1.0
description: "Aggregate classified items into taxonomy with statistics"
---

# Taxonomy Builder

## Purpose

Aggregate all classified items from batch outputs into a unified taxonomy with counts, percentages, and cross-tabulation.

## Input

| Parameter | Type | Description |
|-----------|------|-------------|
| session_id | string | Session identifier |
| batches_dir | string | Directory containing batch outputs |
| output_path | string | Where to write taxonomy.yaml |

## Procedure

### Step 1: Collect All Classified Items

```
# Find all classified item files
classified_files = Glob("{batches_dir}/*/*.yaml")

# Exclude manifest.yaml
classified_files = filter(f => !f.endsWith("manifest.yaml"))

items = []
for file in classified_files:
  item = Read(file)
  items.append(item)
```

### Step 2: Build Category Counts

```yaml
categories:
  tech: 0
  product: 0
  content: 0
  personal: 0
  creative: 0
```

For each item:
```
categories[item.classification.category] += 1
```

Calculate percentages:
```
for category in categories:
  category.percentage = round(category.count / total_items * 100, 1)
```

### Step 3: Build Sentiment Counts

```yaml
sentiments:
  positive: 0
  neutral: 0
  negative: 0
```

For each item:
```
sentiments[item.classification.sentiment] += 1
```

Calculate percentages.

### Step 4: Build Tag Frequency

```
tag_counts = {}
for item in items:
  for tag in item.classification.tags:
    tag_counts[tag] = (tag_counts[tag] || 0) + 1
```

Sort by count descending:
```yaml
tags:
  - name: react-hooks
    count: 12
  - name: api-design
    count: 8
  # ...
```

### Step 5: Build Cross-Tabulation

Category Ã— Sentiment matrix:

```yaml
cross_tabulation:
  tech:
    positive: 15
    neutral: 20
    negative: 5
  product:
    positive: 8
    neutral: 10
    negative: 2
  # ...
```

### Step 6: Write Taxonomy

```yaml
# Taxonomy
# Generated by: taxonomy-builder skill
# Created at: {timestamp}

metadata:
  session_id: "classify_20260130_abc123"
  total_items: 100
  batches_processed: 2
  created_at: "2026-01-30T10:30:00Z"

categories:
  tech:
    count: 40
    percentage: 40.0
  product:
    count: 20
    percentage: 20.0
  content:
    count: 20
    percentage: 20.0
  personal:
    count: 10
    percentage: 10.0
  creative:
    count: 10
    percentage: 10.0

sentiments:
  positive:
    count: 35
    percentage: 35.0
  neutral:
    count: 50
    percentage: 50.0
  negative:
    count: 15
    percentage: 15.0

tags:
  - name: react-hooks
    count: 12
  - name: api-design
    count: 8
  - name: landing-page
    count: 7
  # ... top 50 tags

cross_tabulation:
  tech:
    positive: 15
    neutral: 20
    negative: 5
  product:
    positive: 8
    neutral: 10
    negative: 2
  content:
    positive: 7
    neutral: 10
    negative: 3
  personal:
    positive: 3
    neutral: 5
    negative: 2
  creative:
    positive: 2
    neutral: 5
    negative: 3
```

## Output

Write to: `{output_path}` (typically `artifacts/{session}/taxonomy.yaml`)

## Validation

After aggregation:
1. Verify category counts sum to total_items
2. Verify sentiment counts sum to total_items
3. Verify cross-tabulation rows sum correctly

## Error Handling

| Error | Action |
|-------|--------|
| No classified files found | Error: "No classified items in {batches_dir}" |
| Missing classification field | Log warning, skip item |
| Invalid category/sentiment | Log warning, use "unknown" bucket |
