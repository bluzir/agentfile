---
name: partition
type: atomic
version: v1.0
description: "Data partitioning into batches for parallel processing"
---

# Partition

## Purpose

Split a directory of items into fixed-size batches for parallel processing. This is data partitioning (by count), not semantic partitioning (by meaning).

## Input

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| data_dir | string | required | Directory containing items to classify |
| batch_size | number | 50 | Items per batch |
| session_id | string | required | Session identifier |

## Procedure

### Step 1: Scan Directory

```
items = Glob("{data_dir}/*.yaml")
```

Sort items by filename for deterministic batching.

### Step 2: Calculate Batches

```
total_items = len(items)
num_batches = ceil(total_items / batch_size)
```

### Step 3: Create Batches

```
batches = []
for i in range(num_batches):
  start = i * batch_size
  end = min((i + 1) * batch_size, total_items)
  batch = {
    id: str(i + 1).padStart(2, '0'),  # "01", "02", etc.
    items: items[start:end]
  }
  batches.append(batch)
```

### Step 4: Write Manifest

Create directory:
```
mkdir -p artifacts/{session_id}/batches/
```

Write manifest:
```yaml
# Partition manifest
# Generated by: partition skill
# Created at: {timestamp}

total_items: 100
batch_size: 50
num_batches: 2
batches:
  - id: "01"
    count: 50
    items:
      - data/sample/item-001.yaml
      - data/sample/item-002.yaml
      # ... 50 items
  - id: "02"
    count: 50
    items:
      - data/sample/item-051.yaml
      - data/sample/item-052.yaml
      # ... 50 items
```

## Output

Write to: `artifacts/{session_id}/batches/manifest.yaml`

## Edge Cases

| Case | Handling |
|------|----------|
| Empty directory | Error: "No items found in {data_dir}" |
| Single item | Create single batch with 1 item |
| Items < batch_size | Create single batch with all items |
| Non-yaml files | Skip, only process *.yaml |

## Validation

After writing:
1. Read back manifest
2. Verify total count matches
3. Verify all item paths exist

## Example

Input:
- data_dir: `data/sample/`
- batch_size: 50
- 100 items in directory

Output:
```yaml
total_items: 100
batch_size: 50
num_batches: 2
batches:
  - id: "01"
    count: 50
    items: [data/sample/item-001.yaml, ..., data/sample/item-050.yaml]
  - id: "02"
    count: 50
    items: [data/sample/item-051.yaml, ..., data/sample/item-100.yaml]
```
