# Research Dashboard Interface
# Defines how to render research session data

id: research-dashboard
title: "Research Dashboard"
version: "1.0"
icon: "search"

# =============================================================================
# VARIABLES
# =============================================================================

variables:
  session_id:
    type: string
    description: "Current or specified session ID"
  today:
    type: date
    format: "YYYY-MM-DD"

# =============================================================================
# DATA SOURCES
# =============================================================================

sources:
  state: "artifacts/{session_id}/state.yaml"
  plan: "artifacts/{session_id}/plan.yaml"
  synthesis: "artifacts/{session_id}/synthesis.yaml"
  quality: "artifacts/{session_id}/quality.yaml"

# =============================================================================
# PAGES
# =============================================================================

pages:
  # ---------------------------------------------------------------------------
  # Overview Page
  # ---------------------------------------------------------------------------
  - id: overview
    title: "Overview"
    icon: "home"

    sections:
      # Status Row
      - id: status
        title: "Pipeline Status"
        layout: row
        fields:
          - source: state
            path: current_phase
            type: chip
            label: "Phase"
            color: primary

          - source: quality
            path: verdict
            type: chip
            label: "Quality"
            color:
              PASS: success
              WARN: warning
              FAIL: error

          - source: state
            path: last_updated
            type: date
            label: "Updated"
            format: "HH:mm"

      # Progress Grid
      - id: progress
        title: "Phase Progress"
        layout: grid
        columns: 5
        fields:
          - source: state
            path: phase_states.planning
            type: status
            label: "Planning"
            icon:
              completed: check
              in_progress: spinner
              failed: x
              pending: circle

          - source: state
            path: phase_states.research
            type: status
            label: "Research"

          - source: state
            path: phase_states.synthesis
            type: status
            label: "Synthesis"

          - source: state
            path: phase_states.quality_gate
            type: status
            label: "Quality"

          - source: state
            path: phase_states.report
            type: status
            label: "Report"

      # Metrics
      - id: metrics
        title: "Research Metrics"
        layout: grid
        columns: 4
        condition: "synthesis exists"
        fields:
          - source: plan
            path: aspects.length
            type: stat
            label: "Aspects"

          - source: synthesis
            path: metadata.total_findings
            type: stat
            label: "Findings"

          - source: synthesis
            path: metadata.total_sources
            type: stat
            label: "Sources"

          - source: synthesis
            path: insights.length
            type: stat
            label: "Insights"

  # ---------------------------------------------------------------------------
  # Quality Page
  # ---------------------------------------------------------------------------
  - id: quality
    title: "Quality"
    icon: "check-circle"
    condition: "quality exists"

    sections:
      # Quality Scores
      - id: scores
        title: "Quality Scores"
        layout: grid
        columns: 4
        fields:
          - source: quality
            path: scores.saturation.value
            type: progress_bar
            label: "Saturation"
            max: 100
            threshold: 50
            suffix: "%"

          - source: quality
            path: scores.diversity.value
            type: progress_bar
            label: "Diversity"
            max: 1
            threshold: 0.5
            format: percent

          - source: quality
            path: scores.tier_quality.value
            type: progress_bar
            label: "Tier Quality"
            max: 1
            threshold: 0.6
            format: percent

          - source: quality
            path: scores.evidence_depth.value
            type: metric
            label: "Evidence Depth"
            threshold: 3
            compare: gte
            indicator: check

      # Issues
      - id: issues
        title: "Issues"
        layout: list
        condition: "quality.issues.length > 0"
        fields:
          - source: quality
            path: issues
            type: list
            item_template: "{severity}: {issue}"

      # Recommendations
      - id: recommendations
        title: "Recommendations"
        layout: list
        condition: "quality.recommendations.length > 0"
        fields:
          - source: quality
            path: recommendations
            type: list

  # ---------------------------------------------------------------------------
  # Insights Page
  # ---------------------------------------------------------------------------
  - id: insights
    title: "Insights"
    icon: "lightbulb"
    condition: "synthesis exists"

    sections:
      # Key Insights
      - id: key_insights
        title: "Key Insights"
        layout: card
        fields:
          - source: synthesis
            path: insights
            type: list
            limit: 5
            item_template: |
              **{title}** ({confidence})
              {description}

      # Themes
      - id: themes
        title: "Themes"
        layout: grid
        columns: 2
        fields:
          - source: synthesis
            path: themes
            type: list
            item_template: |
              **{name}**
              {insights.length} insights

      # Patterns
      - id: patterns
        title: "Cross-Aspect Patterns"
        layout: list
        fields:
          - source: synthesis
            path: cross_aspect_patterns
            type: list
            item_template: "{pattern} (strength: {strength})"

  # ---------------------------------------------------------------------------
  # Sources Page
  # ---------------------------------------------------------------------------
  - id: sources
    title: "Sources"
    icon: "link"
    condition: "synthesis exists"

    sections:
      # Source Summary
      - id: summary
        title: "Source Summary"
        layout: grid
        columns: 3
        fields:
          - source: synthesis
            path: source_summary.total
            type: stat
            label: "Total Sources"

          - source: synthesis
            path: metadata.unique_domains
            type: stat
            label: "Unique Domains"

          - source: synthesis
            path: quality_metrics.diversity
            type: percent
            label: "Diversity Score"

      # Tier Distribution
      - id: tiers
        title: "By Tier"
        layout: row
        fields:
          - source: synthesis
            path: source_summary.by_tier.S
            type: stat
            label: "S-Tier"
            color: success

          - source: synthesis
            path: source_summary.by_tier.A
            type: stat
            label: "A-Tier"
            color: primary

          - source: synthesis
            path: source_summary.by_tier.B
            type: stat
            label: "B-Tier"

          - source: synthesis
            path: source_summary.by_tier.C
            type: stat
            label: "C-Tier"
            color: muted

          - source: synthesis
            path: source_summary.by_tier.D
            type: stat
            label: "D-Tier"
            color: muted

      # Top Domains
      - id: domains
        title: "Top Domains"
        layout: list
        fields:
          - source: synthesis
            path: source_summary.top_domains
            type: list
            limit: 10

  # ---------------------------------------------------------------------------
  # Actions Page
  # ---------------------------------------------------------------------------
  - id: actions
    title: "Actions"
    icon: "play"

    sections:
      - id: commands
        title: "Commands"
        layout: commands
        commands:
          - id: continue
            label: "Continue"
            icon: "play"
            primary: true
            condition: "state.current_phase != 'report' AND quality.verdict != 'FAIL'"
            description: "Continue to next phase"

          - id: retry
            label: "Retry Phase"
            icon: "refresh"
            condition: "state.phase_states[state.current_phase] == 'failed'"
            description: "Retry the failed phase"

          - id: export
            label: "Export Report"
            icon: "download"
            condition: "FINAL_REPORT.md exists"
            description: "Export final report"

          - id: reset
            label: "Reset Session"
            icon: "trash"
            color: error
            confirm: "This will delete all progress. Continue?"
            description: "Start over from scratch"

# =============================================================================
# RENDER HINTS
# =============================================================================

render:
  cli:
    max_width: 120
    use_colors: true
    progress_style: bar

  chat:
    format: markdown
    collapsible_sections: true

  api:
    include_metadata: true
    flatten_paths: false
